<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022) - Tiexin Guo</title><meta name=Description content="This is my cool site"><meta property="og:title" content="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)"><meta property="og:description" content="1 What is Dagger? TL;DR: Dagger runs your CI/CD pipelines locally in a Docker container, and can run the container in any CI environment (as long as that CI can run a container, of course.) Do you want the long answer to this million-dollar question? It&rsquo;s hard to answer, honestly. News is calling it a &ldquo;DevOps platform&rdquo;; the VC that funded Dagger even called it a &ldquo;DevOps operating system.&rdquo; But,"><meta property="og:type" content="article"><meta property="og:url" content="https://www.guotiexin.com/posts/dagger-in-depth/"><meta property="og:image" content="https://www.guotiexin.com/posts/dagger-in-depth/banner.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-12T00:00:00+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.guotiexin.com/posts/dagger-in-depth/banner.jpg"><meta name=twitter:title content="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)"><meta name=twitter:description content="1 What is Dagger? TL;DR: Dagger runs your CI/CD pipelines locally in a Docker container, and can run the container in any CI environment (as long as that CI can run a container, of course.) Do you want the long answer to this million-dollar question? It&rsquo;s hard to answer, honestly. News is calling it a &ldquo;DevOps platform&rdquo;; the VC that funded Dagger even called it a &ldquo;DevOps operating system.&rdquo; But,"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.guotiexin.com/posts/dagger-in-depth/><link rel=prev href=https://www.guotiexin.com/posts/creating-a-dtm-plugin-for-anything/><link rel=next href=https://www.guotiexin.com/posts/9-terraform-best-practices/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.guotiexin.com\/posts\/dagger-in-depth\/"},"image":[{"@type":"ImageObject","url":"https:\/\/www.guotiexin.com\/posts\/dagger-in-depth\/banner.jpg","width":1200,"height":800}],"genre":"posts","keywords":"ci, devops","wordcount":1609,"url":"https:\/\/www.guotiexin.com\/posts\/dagger-in-depth\/","datePublished":"2022-04-12T00:00:00+00:00","dateModified":"2022-04-12T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Tiexin Guo | 郭铁心"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tiexin Guo"><span class=header-title-pre><i class="fa fa-solid fa-terminal"></i></span>Tiexin Guo<span class=header-title-post><i class="fa fa-solid fa-user-secret"></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about>About </a><a class=menu-item href=/portfolio>Portfolio </a><a class=menu-item href=/posts/>Archive </a><a class=menu-item href=https://github.com/ironcore864 rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tiexin Guo"><span class=header-title-pre><i class="fa fa-solid fa-terminal"></i></span>Tiexin Guo<span class=header-title-post><i class="fa fa-solid fa-user-secret"></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about title>About</a><a class=menu-item href=/portfolio title>Portfolio</a><a class=menu-item href=/posts/ title>Archive</a><a class=menu-item href=https://github.com/ironcore864 title rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/IronCore864 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Tiexin Guo | 郭铁心</a></span>&nbsp;<span class=post-category>included in <a href=/categories/ci/><i class="far fa-folder fa-fw" aria-hidden=true></i>CI</a>&nbsp;<a href=/categories/devops/><i class="far fa-folder fa-fw" aria-hidden=true></i>DevOps</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-04-12>2022-04-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1609 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/dagger-in-depth/banner.jpg data-srcset="/posts/dagger-in-depth/banner.jpg, /posts/dagger-in-depth/banner.jpg 1.5x, /posts/dagger-in-depth/banner.jpg 2x" data-sizes=auto alt=/posts/dagger-in-depth/banner.jpg title=/posts/dagger-in-depth/banner.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-what-is-dagger>1 What is Dagger?</a></li><li><a href=#2-quirks-and-features>2 Quirks and Features</a><ul><li><a href=#21-buildkit>2.1 BuildKit</a></li><li><a href=#22-cue>2.2 CUE</a></li><li><a href=#23-wait-a-minute>2.3 Wait a Minute</a></li></ul></li><li><a href=#3-enough-tech-spec-what-does-dagger-do>3 Enough Tech Spec. What Does Dagger Do?</a><ul><li><a href=#31-what-dagger-isnt>3.1 What Dagger Isn&rsquo;t</a></li><li><a href=#32-so-just-a-wrapper>3.2 So, Just a Wrapper?</a></li><li><a href=#33-what-dagger-can-do>3.3 What Dagger Can Do</a></li></ul></li><li><a href=#4-what-dagger-really-is>4 What Dagger Really Is</a></li><li><a href=#5-benefits>5 Benefits</a><ul><li><a href=#51-local-development>5.1 Local Development</a></li><li><a href=#52-on-premise-ci>5.2 &ldquo;On-Premise&rdquo; CI</a></li><li><a href=#53-migrate-to-another-ci>5.3 Migrate to Another CI</a></li></ul></li><li><a href=#6-should-i-use-dagger-now>6 Should I use Dagger Now?</a></li></ul></nav></div></div><div class=content id=content><h2 id=1-what-is-dagger>1 What is Dagger?</h2><p>TL;DR: Dagger runs your CI/CD pipelines locally in a Docker container, and can run the container in any CI environment (as long as that CI can run a container, of course.)</p><p>Do you want the long answer to this million-dollar question? It&rsquo;s hard to answer, honestly. News is calling it a &ldquo;DevOps platform&rdquo;; the VC that funded Dagger even called it a &ldquo;DevOps operating system.&rdquo;</p><p>But, in fact, Dagger is neither of those things.</p><p>Before we can answer what Dagger is, let&rsquo;s have a look at it in-depth:</p><h2 id=2-quirks-and-features>2 Quirks and Features</h2><h3 id=21-buildkit>2.1 BuildKit</h3><p>In Dagger, the configuration is executed in BuildKit, which is the execution engine at the heart of Docker.</p><p>BuildKit was developed as part of the Moby project, the latter of which is an open framework to assemble specialized container systems without reinventing the wheel by Docker. Basically, it&rsquo;s a toolkit for converting source code to build artifacts in an efficient, expressive, and repeatable manner. It was announced in 2017 and began shipping with Docker Engine in 2018’s version 18.09.</p><h3 id=22-cue>2.2 CUE</h3><p>Unlike most popular CI systems out there, you don&rsquo;t write YAML in Dagger; you write CUE.</p><p>I feel you because I didn&rsquo;t know what&rsquo;s CUE either. Turned out, CUE is an open-source data validation language and inference engine with its roots in logic programming.</p><p>It aims to simplify tasks involving defining and using data. It&rsquo;s actually a superset of JSON, so users familiar with JSON should feel comfortable with it already and can get started quickly. It also has got built-in auto-formatting (yay.)</p><p>Although the language is not a general-purpose programming language, it has many applications, such as data validation, data templating, configuration (that&rsquo;s probably why Dagger decided to use it in the first place), querying, code generation, and even scripting.</p><h3 id=23-wait-a-minute>2.3 Wait a Minute</h3><p>Since it&rsquo;s already reusing Docker&rsquo;s parts for configuration execution, why not reuse Docker&rsquo;s other part, Dockerfile, for configuration?</p><p>What&rsquo;s the purpose of using another language just for the configuration?</p><p>Solomon Hykes, the founder of Dagger, actually answered exact this question on their official Discord channel:</p><blockquote><p>We needed a modern declarative language with a type system, a package manager, native yaml and json interop, a formal spec, and a standalone community not locked to one tool.</p><p>Also Dockerfiles are specific to build, but Dagger is more general-purpose automation</p><p>There was no way at all Dockerfile could support our requirements (speaking as one of the original authors of the Dockerfile syntax)</p></blockquote><h2 id=3-enough-tech-spec-what-does-dagger-do>3 Enough Tech Spec. What Does Dagger Do?</h2><h3 id=31-what-dagger-isnt>3.1 What Dagger Isn&rsquo;t</h3><p>First, let me tell you what Dagger isn&rsquo;t by quoting the official documentation:</p><blockquote><p>Dagger does not replace your CI: it improves it by adding a portable development layer on top of it.</p></blockquote><p>OK, so it&rsquo;s not yet another CI (or CD, for that matter).</p><p>Dagger didn&rsquo;t even try to <em>replace</em> your existing CI, at all. But rather, it <em>improves</em> your CI, by adding a wrapper layer.</p><p>I know the term &ldquo;wrapper&rdquo; doesn&rsquo;t sound fancy, so let&rsquo;s call it by its official reference, and that is &ldquo;portable development layer&rdquo;.</p><h3 id=32-so-just-a-wrapper>3.2 So, Just a Wrapper?</h3><p>Disappointed? Don&rsquo;t conclude too quick; follow me. First, let&rsquo;s look at some other DevOps/cloud related examples:</p><ul><li>Think of Terraform. You&rsquo;ve got multiple environments to manage. Even with reuseable modules and roles, you still have duplicated code across envs. Then comes Terragrunt, which is a (thin) wrapper that provides extra tools for keeping your configurations simple without repeating yourself.</li><li>Think of AWS CDK. It actually is a wrapper layer on top of CloudFormation, which lets you use your familiar programming languages to define and provision AWS cloud infrastructure, so that you don&rsquo;t have to deal with CloudFormation&rsquo;s non-human-readable configurations. Of course, your code still converts to a format that CloudFormation understands, and your infrastructure is still managed by CloudFormation; AWS CDK doesn&rsquo;t really interact with AWS APIs directly. That&rsquo;s why it&rsquo;s only a wrapper layer on top of CloudFormation.</li><li>Think of CDKTF (CDK for Terraform); it&rsquo;s no different than AWS CDK, perhaps because CDKTF is inspired by AWS CDK and also uses AWS&rsquo;s <code>jsii</code> library to be polyglot. It&rsquo;s a wrapper layer on top of Terraform that translates your code into Terraform HCL so that you don&rsquo;t have to learn HCL. But in essence, your infrastructure is still managed by Terraform HCL, not your code directly. So, it&rsquo;s yet another wrapper.</li></ul><p>You must have already figured out where I am going with this, and you are right: yes, Dagger is no different. It is a wrapper.</p><p>But, of course, the wrapper has to do something to be useful, right? Then what exactly does Dagger do? What exactly does Dagger wrap? Good Questions.</p><h3 id=33-what-dagger-can-do>3.3 What Dagger Can Do</h3><p>In any CI system, you define some steps and actions in a certain format (YAML, most likely) and run it in your CI system. For example, in Jenkins, maybe you will write some groovy file. In GitHub Actions, you write some YAML with multiple steps.</p><p>Basically, Dagger runs those &ldquo;steps and actions&rdquo; in a Docker container. Then where do you run the Dagger docker container itself? Great question: you can either run it locally (because you can install Docker desktop, right?) or in your existing CI (since most CIs can run a docker container.)</p><p>If you think about it: Dagger doesn&rsquo;t wrap your CI pipelines or systems. It wraps those detailed steps and actions into a Docker container and still runs in your existing CI. It&rsquo;s like writing a big Dockerfile, and when you run the container, it does git clone, source code static scan, test, build, artifact upload, and what have you.</p><h2 id=4-what-dagger-really-is>4 What Dagger Really Is</h2><p>Yes, Dagger is a wrapper, that part is true.</p><p>But, it doesn&rsquo;t wrap CI systems; it wraps your pipeline steps and actions into a container (you have to rewrite those steps and actions in Dagger&rsquo;s syntax, though), and the wrapped result can run in another CI (as long as that CI can run a container.)</p><p>In this sense, Dagger <em>is</em> yet another CI, except that CI runs in a container and most CI systems happen to be able to run containers.</p><h2 id=5-benefits>5 Benefits</h2><p>I think there are 3 major advantages of using Dagger</p><h3 id=51-local-development>5.1 Local Development</h3><p>Firstly, there is no need to install <em>any</em> dependencies specific to this application, because Dagger manages all the intermediate steps and transient dependencies inside the Docker container.</p><p>This might not be an advantage if we are talking about CI, but it is an advantage if we are talking about local development.</p><p>Think of Go where you have to install modules or think of Nodejs where you might even need to switch Node versions then do an NPM install. Now you can do all of those inside a container and only get the final result to your local laptop.</p><h3 id=52-on-premise-ci>5.2 &ldquo;On-Premise&rdquo; CI</h3><p>You can run your pipeline locally now since you can easily have the Docker desktop up and running locally.</p><p>I&rsquo;m not sure if this is a solid requirement, though. Maybe it is? Because we all have powerful laptops now; why waste money on some CI systems when you can run them locally?</p><p>The idea of running it anywhere as long as Docker is available is intriguing, though. If you don&rsquo;t want to buy CI as a service, you can run Dagger in your own infrastructure.</p><h3 id=53-migrate-to-another-ci>5.3 Migrate to Another CI</h3><p>Since your &ldquo;steps and actions&rdquo; now are running in a container, you can run it elsewhere, in another CI system.</p><p>Should you need to migrate to another CI, you do not need to rewrite your CI steps anymore. For example, you don&rsquo;t want to use your company&rsquo;s old Jenkins instance anymore, but you are already using Dagger with Jenkins, and now you want to give GitHub Actions a try.</p><p>It&rsquo;s worth noting that in this scenario, there are still two things to do:</p><ul><li>If you are using Jenkins now, and want to migrate those Jenkins pipelines into Dagger, you need to do it manually. The cost is the same (if not more) as rewriting your whole pipeline in GitHub Actions&rsquo; syntax.</li><li>You will still need to learn about your new CI system: how a job is triggered, the syntax, etc.</li></ul><p>Here you can see Dagger does provide a solution to avoid CI lock-in (to some extent.) But it is not a game changing solution that could resolve your flexibility concern.</p><p>For a DevOps engineer, a DevOps toolchain that could accommodate different needs and priorities from different teams is more than appealing. That being said, each component is modular and pluggable, and you could free yourself from tedious work like launching, integrating, and managing all these pieces.</p><p>Ideally, you could define your desired DevOps tools in a single human-readable YAML config file, and with one single command, you have your whole DevOps toolchain and SDLC workflow set up or changed.</p><p>If you are intrigued by the simplicity of &ldquo;DevOps toolchain as code&rdquo;, don&rsquo;t hesitate to check out DevStream <a href=https://github.com/devstream-io/devstream target=_blank rel="noopener noreffer">here</a>.</p><h2 id=6-should-i-use-dagger-now>6 Should I use Dagger Now?</h2><p>Is it promising? Maybe. Should I start using it now? My answer is No. Three reasons:</p><ul><li>The Dagger project itself still uses GitHub Actions. Why? Probably because it has limitations and can&rsquo;t do everything you can achieve with GitHub Actions.</li><li>You probably won&rsquo;t change your CI system every 6 months. If you only change it one time in 4 years, why bother adding that wrapper?</li><li>Dagger is only recently announced. It hasn&rsquo;t supported a whole lot of CI systems yet. Maybe the CI you want to switch to doesn&rsquo;t support it yet.</li></ul><p>Like, comment, subscribe. See you in the next article!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-04-12</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.guotiexin.com/posts/dagger-in-depth/ data-title="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)" data-hashtags=ci,devops><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://www.guotiexin.com/posts/dagger-in-depth/ data-hashtag=ci><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.guotiexin.com/posts/dagger-in-depth/ data-title="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://www.guotiexin.com/posts/dagger-in-depth/ data-title="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://www.guotiexin.com/posts/dagger-in-depth/ data-title="Dagger (the CI/CD Tool, not the Knife) In-Depth - Everything You Need to Know (as of Apr 2022)"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ci/>ci</a>,&nbsp;<a href=/tags/devops/>devops</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/creating-a-dtm-plugin-for-anything/ class=prev rel=prev title="Creating a DevStream (dtm) Plugin for Anything"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Creating a DevStream (dtm) Plugin for Anything</a>
<a href=/posts/9-terraform-best-practices/ class=next rel=next title="9 Extraordinary Terraform Best Practices That Will Change Your Infra World">9 Extraordinary Terraform Best Practices That Will Change Your Infra World<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Copyright: Tiexin Guo | CC BY-NC 4.0</div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>